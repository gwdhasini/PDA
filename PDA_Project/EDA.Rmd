---
title: "PDA_EDA"
author: "Maria Pia El Asmar & Hasini Gunawardena"
date: "10/30/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Packages to be put in the next section at the end of the project
```{r setup, echo = FALSE, warning = FALSE, message = FALSE}
library(tidyverse)
library(DT)
library(Hmisc)  
library(tidyquant)
library(ggthemes)
library(RColorBrewer)
library(corrplot)
library(psych)
library(GGally)
library(corrr)
library(corrplot)
library(ggcorrplot)
library(kableExtra)
#library(DataExplorer)
library(inspectdf)
```


```{r setup2, echo = FALSE, warning = FALSE, message = FALSE}
knitr::opts_chunk$set(
  comment = "#>",
  collapse = TRUE,
  cache = TRUE,
  fig.retina = 0.8, # figures are either vectors or 300 dpi diagrams
  dpi = 300,
  out.width = "70%",
  fig.align = 'center',
  fig.width = 6,
  fig.asp = 0.618,  
  fig.show = "hold"
)

ggplot2::theme_set(ggplot2::theme_light())

options(
  digits = 3,
  str = strOptions(strict.width = "cut"),
  width = 69,
  tibble.width = 69,
  cli.unicode = FALSE
)
```


# Introduction

```{r, echo=FALSE}
GermanCredit <- read.csv(
  here::here("data/GermanCredit.csv"),
  header = TRUE,
  sep = ";",
  dec = "."
)[,-1]

```


# Exploratory Data Analysis

## Structure & Summary

We are going to start our exploratory data analysis by understanding the data. First, let us observe the type of variables of the dataset:

```{r, echo=FALSE}
str(GermanCredit)
```

We note that all the variables are integer. However, from the data description, a lot of those are actually categorical variables. Hence, in order to have consistent results in our analysis, we are going to transform these variables from integer to factors.
QUESTION: should we keep the head?

```{r, echo=FALSE}
head(GermanCredit)
```

Transformation of integer variables into correct categorical ones, we use a for loop. 
While analysing the data, we noted that the variable "EDUCATION" has one outlier: indeed, in one observation it is equal to "-1" instead of 0/1. For this reason, we change the value of this observation before transforming the variables into categorical ones.

```{r, echo=FALSE}

# changing education
for (i in 1:1000){
  if (GermanCredit[i,8] == "-1") {
    GermanCredit[i,8] <- 1
    GermanCredit[,8] <- as.factor(GermanCredit[,8])
  }
}

for (i in (1:31)) {
  if (is.integer(GermanCredit[,i]) & i != 2 & i !=10  & i != 13  & i !=22  & i !=26  & i != 28) {
  GermanCredit[,i] <- as.factor(GermanCredit[,i])
  }
}

```

```{r, echo=FALSE}
str(GermanCredit) #la structure après les modifs. Je t'ai noté les trucs bizarres que j'ai vu mais n'hésites pas à re-checker au cas où
```

Now that the variables are in the correct form, we can move one with our analysis.

We start by looking at the structure of the dataset.

```{r, echo=FALSE}
library(DataExplorer)
plot_intro(GermanCredit)

types<-inspect_types(GermanCredit)
show_plot(types, col_palette=2)
```

From the first plot, we note that there are no missing observations. Moreover, after the variables transformation 81% of them have discrete values, meaning that these are categorical variables. That is confirmed by the second plot that gives us the exact number of columns which are integer and the ones that are factors (categorical variables).

We are now going to dive deeper into the variables' analysis. 

```{r, echo=FALSE}
library(psych)
library(Hmisc)
summary(GermanCredit)
describe(GermanCredit) # QUESTION: shoul we keep this? I'm not sure it gives us a lot of useful info
```

The summary gives us a first overview of the variables' details. Interestingly, some categorical variables present an unequal distribution of values. For instance, we note that the variable "CO.APPLICANT" is 0 959 times and 1 only 41 times. A similar comment can be made for other categorical variables like "MALE_MAR_or_WID", "FOREIGN", "MALE_DIV", "EDUCATION". This finding is particularly interesting as it raises the following question: is the value of a categorical variable discriminatory for the outcome of the response variable? For instance, if we have an observation where "CO.APPLICANT" = 1, what is the value of "RESPONSE"? QUESTION: Est ce qu'on met ca ou ce n est pas clair?

Let us now analyse the non-categorical variables. For those, we can look at the min and the max, which gives us a range. For instance, we see that in this bank the duration of the loan goes from 4 to 72 months. Moreover, we see that the Max variable "AGE" is 125. This is an inconsistency in the dataset. First, we are going to see if such observation is just one outlier or if there are many of them, and then, we are going to remove them. This will allows us to have robust results.


```{r, echo=FALSE}

GermanCredit %>% 
  select (AGE) %>% 
  group_by(AGE) %>% 
  count() %>% 
  arrange(desc(AGE)) %>% kable()
```

Only one observation has AGE = 125, so we remove it from the dataset.

```{r, echo=FALSE}
GermanCredit <- GermanCredit %>% 
  filter(AGE != "125")
```

```{r, echo=FALSE}
library(DT)
datatable(head(GermanCredit), class = "cell-border stripe") #Ca apparait pas haha 
# PIA: à checker quand on va knit
#QUESTION: finalement ca aussi c'est le head donc on peut le mettre à la place de celui au debut pour ne pas se repeter
```

```{r, echo=FALSE}
library(inspectdf)
# types<-inspect_types(GermanCredit)
# show_plot(types, col_palette=2)

# num.var<-inspect_num(GermanCredit)
# show_plot(num.var, col_palette=3)
#QUESTION: we have the same histogram below, I think we should remove this one so we don't repeat ourselves

cat.var<-inspect_cat(GermanCredit) 
show_plot(cat.var) 

```

This plot allows us to have a better visualization of how the factor variables are distributed. We confim that for most of them, the amount of times their values is 0 is not equal to when they have a value of 1. The only variable that seems to have a similar distribution of 1 and 0 is MALE_SINGLE. 

## Histogram & Density

```{r, echo=FALSE}
library(ggplot2)
plot_histogram(GermanCredit[,-31])
plot_density(GermanCredit[,-31],
             ggtheme = theme_bw())
```

## Side-by-side boxplots

```{r, echo=FALSE}
plot_boxplot(GermanCredit,
             by = 'RESPONSE',
             ncol = 2,
             title = "Side-by-side boxplots")


```

```{r, echo=FALSE}
lblue <- "#6699CC"
par(mfrow = c(2, 3))

boxplot(AGE ~ RESPONSE, data = GermanCredit, xlab = "Response", notch = T, 
    varwidth = T, col = lblue)
boxplot(AMOUNT ~ RESPONSE, data = GermanCredit, xlab = "Response", varwidth = T, col = lblue)
boxplot(DURATION ~ RESPONSE, data = GermanCredit, xlab = "Response", varwidth = T, col = lblue)
boxplot(INSTALL_RATE ~ RESPONSE, data = GermanCredit, xlab = "Response", varwidth = T, col = lblue)
boxplot(NUM_CREDITS ~ RESPONSE, data = GermanCredit, xlab = "Response", varwidth = T, col = lblue)


```

## Correlations

```{r, echo=FALSE, fig.width= 8, fig.height= 7}
library(GGally)
plot_correlation(GermanCredit, type= 'c', cor_args = list( 'use' = 'complete.obs'))
#ggpairs(GermanCredit, ggplot2::aes(colour = RESPONSE)) ça prend trop de temps à run
#Il y a plein plein de plots de correlation différentes, du coup j'en ai seulement mis 2 mais dis moi si y en a un qui te plaît plus


```

## Good vs Bad credits
```{r, echo=FALSE}
#from WS 4
library(explore)
GermanCredit %>% explore(RESPONSE)


#CHECK QUE TOUTES LES VARIABLES ON ETE CONSIDERE
GermanCredit %>% 
  select(TELEPHONE, RADIO.TV, RESPONSE) %>% 
  explore_all(target = RESPONSE)

GermanCredit %>% 
  select(NEW_CAR, USED_CAR,FURNITURE,EDUCATION, RESPONSE) %>% 
  explore_all(target = RESPONSE)

GermanCredit %>% 
  select(FOREIGN, MALE_DIV, MALE_SINGLE, MALE_MAR_or_WID, RESPONSE) %>% 
  explore_all(target = RESPONSE)

GermanCredit %>% 
  select(GUARANTOR, CO.APPLICANT, PROP_UNKN_NONE, OTHER_INSTALL, RESPONSE) %>% 
  explore_all(target = RESPONSE)

GermanCredit %>% 
  select(REAL_ESTATE, RENT, OWN_RES, RETRAINING, RESPONSE) %>% 
  explore_all(target = RESPONSE)

```














